# Standard Mode: Let Nixpacks detect providers now that git structure is fixed
providers = ["node", "python"]

[variables]
PIP_BREAK_SYSTEM_PACKAGES = "1"
NIXPACKS_NODE_VERSION = "20"
NIXPACKS_PYTHON_VERSION = "3.11"

[phases.install]
# Force install of both requirements
cmds = [
    "python -m venv --copies /opt/venv && . /opt/venv/bin/activate && pip install -r requirements.txt",
    "npm install --prefix /app/frontend"
]

[phases.build]
# Force frontend build
cmds = [
    "npm run build --prefix /app/frontend"
]

[start]
cmd = ". /opt/venv/bin/activate && uvicorn backend.main:app --host 0.0.0.0 --port $PORT"
